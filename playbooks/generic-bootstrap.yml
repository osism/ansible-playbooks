---
- name: Gather facts for all hosts
  hosts: manager
  gather_facts: false
  tasks:
    - name: Gathers facts about remote hosts
      setup:

- name: Apply role hostname
  hosts: all
  serial: "{{ osism_serial['hostname']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.hostname
      tags: hostname

- name: Apply role hosts
  hosts: all
  serial: "{{ osism_serial['hosts']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.hosts
      tags: hosts

- name: Apply role proxy
  hosts: all
  serial: "{{ osism_serial['proxy']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.proxy
      tags: proxy

- name: Apply role resolvconf
  hosts: all
  serial: "{{ osism_serial['resolvconf']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.resolvconf
      tags: resolvconf

- name: Apply role repository
  hosts: all
  serial: "{{ osism_serial['repository']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.repository
      tags: repository

- name: Apply role rsyslog
  hosts: all
  serial: "{{ osism_serial['rsyslog']|default(osism_serial_default)|default(0) }}"

  collections:
    - osism.services

  roles:
    - role: rsyslog
      tags: rsyslog

- name: Apply role common
  hosts: all
  serial: "{{ osism_serial['common']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.common
      tags: common

- name: Apply role debops.grub
  hosts: all
  serial: "{{ osism_serial['grub']|default(osism_serial_default)|default(0) }}"
  become: true

  collections:
    - debops.roles02

  roles:
    - role: grub
      tags: grub

- name: Apply role ANXS.timezone
  hosts: all
  serial: "{{ osism_serial['timezone']|default(osism_serial_default)|default(0) }}"
  become: true

  roles:
    - role: ANXS.timezone
      tags: timezone

- name: Apply role ANXS.utilities
  hosts: all
  serial: "{{ osism_serial['utilities']|default(osism_serial_default)|default(0) }}"
  become: true

  roles:
    - role: ANXS.utilities
      tags: utilities

- name: Apply role osism.docker
  hosts: all
  serial: "{{ osism_serial['docker']|default('1') }}"

  roles:
    - role: osism.docker
      tags: docker

- name: Apply role cockpit
  hosts: all
  serial: "{{ osism_serial['cockpit']|default(osism_serial_default)|default(0) }}"

  collections:
    - osism.services

  roles:
    - role: cockpit
      tags: cockpit

- name: Apply role chrony
  hosts: all
  serial: "{{ osism_serial['chrony']|default(osism_serial_default)|default(0) }}"

  roles:
    - role: osism.chrony
      tags: chrony

- name: Apply role hardening
  hosts: all
  serial: "{{ osism_serial['hardening']|default(osism_serial_default)|default(0) }}"
  become: true

  roles:
    - role: hardening
      tags: hardening

- name: Apply role auditd
  hosts: all
  serial: "{{ osism_serial['auditd']|default(osism_serial_default)|default(0) }}"

  collections:
    - osism.services

  roles:
    - role: auditd
      tags: auditd
